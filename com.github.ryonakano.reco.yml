app-id: com.github.ryonakano.reco
runtime: io.elementary.Platform
runtime-version: '7.2'
sdk: io.elementary.Sdk
command: com.github.ryonakano.reco
finish-args:
  - '--device=all'
  - '--share=ipc'
  - '--socket=wayland'
  - '--socket=fallback-x11'
  - '--socket=pulseaudio'
  - '--env=GST_PLUGIN_PATH_1_0=/app/lib/gstreamer-1.0'
  - '--metadata=X-DConf=migrate-path=/com/github/ryonakano/reco/'
modules:
  - name: gstreamer
    buildsystem: meson
    config_opts:
      # Same options with https://gitlab.com/freedesktop-sdk/freedesktop-sdk/-/blob/master/elements/components/gstreamer-plugins-good.bst
      - '-Dpackage-origin="freedesktop-sdk"'
      - '-Dv4l2-libv4l2=enabled'
      - '-Dv4l2-gudev=disabled'
      - '-Daalib=disabled'
      - '-Djack=disabled'
      - '-Dlibcaca=disabled'
      - '-Ddv=disabled'
      - '-Ddv1394=disabled'
      - '-Dqt5=disabled'
      - '-Dshout2=disabled'
      - '-Dtaglib=disabled'
      - '-Dtwolame=disabled'
      - '-Dexamples=disabled'
      - '-Drpicamsrc=disabled'
    sources:
      - type: archive
        # we need to use the same version with gstreamer installed in SDK
        url: https://gstreamer.freedesktop.org/src/gst-plugins-good/gst-plugins-good-1.20.5.tar.xz
        sha256: e83ab4d12ca24959489bbb0ec4fac9b90e32f741d49cda357cb554b2cb8b97f9
      - type: patch
        path: patches/0001-level-use-GArray-instead-of-deprecated-GValueArray.patch

  - name: gst-libav
    buildsystem: meson
    config_opts:
      - '-Ddoc=disabled'
    sources:
      - type: archive
        # we need to use the same version with gstreamer installed in SDK
        url: https://gstreamer.freedesktop.org/src/gst-libav/gst-libav-1.20.5.tar.xz
        sha256: b152e3cc49d014899f53c39d8a6224a44e1399b4cf76aa5f9a903fdf9793c3cc

  - name: reco
    buildsystem: meson
    sources:
      - type: dir
        path: .
